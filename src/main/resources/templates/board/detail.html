<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head::head('ê¸€ë³´ê¸°')}"></head>
<body>
<header th:replace="~{fragments/header}"></header>

<div class="w-full max-w-4xl mx-auto mt-10">
    <h1 class="text-3xl font-bold mb-8 text-center">ê²Œì‹œê¸€ ìƒì„¸</h1>

    <table class="table w-full border border-base-300">
        <tbody>
        <!-- ì œëª© -->
        <tr>
            <th class="w-32 bg-base-200 text-left px-4 py-2">ì œëª©</th>
            <td class="px-4 py-2">
                <span th:text="${boardDto.title}">ì œëª©</span>
                <span th:if="${boardDto.secretFlag == 1}" class="text-error font-bold ml-1">ğŸ”’ ë¹„ë°€ê¸€</span>
            </td>
        </tr>

        <!-- ê¸€ì“´ì´ -->
        <tr>
            <th class="bg-base-200 text-left px-4 py-2">ê¸€ì“´ì´</th>
            <td class="px-4 py-2" th:text="${boardDto.writer}">ì‘ì„±ì</td>
        </tr>

        <!-- ë‚´ìš© -->
        <tr>
            <th class="bg-base-200 text-left px-4 py-2 align-top">ë‚´ìš©</th>
            <td class="px-4 py-2 whitespace-pre-line" th:text="${boardDto.content}">ë‚´ìš©</td>
        </tr>

        <!-- ì¡°íšŒìˆ˜ -->
        <tr>
            <th class="bg-base-200 text-left px-4 py-2">ì¡°íšŒìˆ˜</th>
            <td class="px-4 py-2" th:text="${boardDto.hit}">0</td>
        </tr>

        <!-- ë‚ ì§œ -->
        <tr>
            <th class="bg-base-200 text-left px-4 py-2">ë‚ ì§œ</th>
            <td class="px-4 py-2" th:text="${#temporals.format(boardDto.regdate, 'yyyy-MM-dd HH:mm')}">2025-10-22</td>
        </tr>
        </tbody>
    </table>

    <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ë¡œê·¸ì¸ + ë³¸ì¸ì¼ ê²½ìš°ë§Œ í‘œì‹œ) -->
    <div class="mt-6 flex justify-end gap-2"
         th:if="${session.loggedMember != null and session.loggedMember.userName == boardDto.writer}">
        <a th:href="@{/board/{id}/update(id=${boardDto.id})}" class="btn btn-primary">ìˆ˜ì •í•˜ê¸°</a>
        <button id="btn-delete" class="btn btn-error">ì‚­ì œí•˜ê¸°</button>
    </div>

    <!-- ì´ì „/ë‹¤ìŒ ê¸€ -->
    <div class="mt-6 border-t border-base-300 pt-4 space-y-2">

        <!-- ì´ì „ ê¸€ -->
        <div>
            <th:block th:if="${prevBoardDto != null}">
                <a th:href="@{/board/{id}/detail(id=${prevBoardDto.id})}"
                   class="link link-hover text-sm text-gray-600">
                    ì´ì „ ê¸€ :
                    <span th:text="${prevBoardDto.title}"></span>
                </a>
            </th:block>
            <th:block th:if="${prevBoardDto == null}">
                <span class="text-gray-400 text-sm">ì´ì „ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</span>
            </th:block>
        </div>

        <!-- ë‹¤ìŒ ê¸€ -->
        <div>
            <th:block th:if="${nextBoardDto != null}">
                <a th:href="@{/board/{id}/detail(id=${nextBoardDto.id})}"
                   class="link link-hover text-sm text-gray-600">
                    ë‹¤ìŒ ê¸€ :
                    <span th:text="${nextBoardDto.title}"></span>
                </a>
            </th:block>
            <th:block th:if="${nextBoardDto == null}">
                <span class="text-gray-400 text-sm">ë‹¤ìŒ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</span>
            </th:block>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer::footer-sns}"></div>

<script th:inline="javascript">
    const msg = /*[[${msg}]]*/ null;
    if (msg) alert(msg);

    const btnDelete = document.querySelector("#btn-delete");
    const boardId = /*[[${boardDto.id}]]*/ 0;

    if (btnDelete) {
        btnDelete.addEventListener("click", async () => {
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const res = await fetch("/board/delete", {
                headers: { "Content-Type": "application/json" },
                method: "POST",
                body: JSON.stringify({ id: boardId })
            });

            const data = await res.json();
            alert(data.message);
            if (data.success) location.href = "/board/list";
        });
    }
</script>
</body>
</html>
