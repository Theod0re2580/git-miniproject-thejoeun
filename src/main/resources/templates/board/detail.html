<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head::head('ê¸€ë³´ê¸°')}"></head>
<link rel="stylesheet" th:href="@{/css/detail.css}">
<body class="flex flex-col min-h-screen bg-base-100">
<header th:replace="~{fragments/header}"></header>

<main>
    <div class="detail-container">
        <h1>ê²Œì‹œê¸€ ìƒì„¸</h1>

        <table class="detail-table">
            <tbody>
            <tr><th>ì œëª©</th><td th:text="${boardDto.title}"></td></tr>
            <tr><th>ê¸€ì“´ì´</th><td th:text="${boardDto.writer}"></td></tr>
            <tr><th>ë‚´ìš©</th><td th:text="${boardDto.content}" class="whitespace-pre-line"></td></tr>
            <tr><th>ì¡°íšŒìˆ˜</th><td th:text="${boardDto.hit}"></td></tr>
            <tr><th>ë‚ ì§œ</th><td th:text="${#temporals.format(boardDto.regdate,'yyyy-MM-dd HH:mm')}"></td></tr>
            </tbody>
        </table>

        <div class="detail-actions"
             th:if="${session.loggedMember != null and session.loggedMember.userName == boardDto.writer}">
            <a th:href="@{/board/{id}/update(id=${boardDto.id})}" class="btn btn-primary">ìˆ˜ì •</a>
            <button id="btn-delete" class="btn btn-error">ì‚­ì œ</button>
        </div>

        <div class="nav-buttons">
            <div th:if="${prevBoardDto != null}">
                <a th:href="@{/board/{id}/detail(id=${prevBoardDto.id})}">
                    â† ì´ì „ê¸€: <span th:text="${prevBoardDto.title}"></span>
                </a>
            </div>
            <div th:if="${nextBoardDto != null}">
                <a th:href="@{/board/{id}/detail(id=${nextBoardDto.id})}">
                    ë‹¤ìŒê¸€: <span th:text="${nextBoardDto.title}"></span> â†’
                </a>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/footer::footer-sns}"></footer>
<script th:inline="javascript">
    document.getElementById("btn-delete")?.addEventListener("click", async () => {
        if (!confirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ğŸ—‘ï¸")) return;

        const boardId = /*[[${boardDto.id}]]*/ 0;

        try {
            const response = await fetch("/board/delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ id: boardId }),
            });

            const result = await response.json();

            if (result.success) {
                alert(result.message);
                window.location.href = "/board/list";
            } else {
                alert(result.message || "ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (err) {
            console.error(err);
            alert("ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ âŒ");
        }
    });
</script>
</body>
</html>
