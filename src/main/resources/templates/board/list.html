<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head::head('ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸')}"></head>
<link rel="stylesheet" th:href="@{/css/list.css}">
<body class="flex flex-col min-h-screen bg-base-100">
<header th:replace="~{fragments/header}"></header>

<main class="flex-grow pt-12 pb-28">

    <!-- âœ… ê²Œì‹œíŒ í…Œì´ë¸” -->
    <div class="board-wrap">
        <th:block th:if="${!boardList.isEmpty()}">
            <table class="board-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>ì œëª©</th>
                    <th>ê¸€ì“´ì´</th>
                    <th>ë‚ ì§œ</th>
                    <th>ì¡°íšŒìˆ˜</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${boardList}">
                    <td th:text="${item.id}"></td>
                    <td>
                        <!-- âœ… ê³µê°œê¸€ -->
                        <a th:if="${item.secretFlag == 0}"
                           th:href="@{/board/{id}/detail(id=${item.id})}"
                           th:text="${item.title}"></a>

                        <!-- âœ… ë¹„ë°€ê¸€ -->
                        <a th:if="${item.secretFlag == 1}"
                           href="#"
                           th:attr="data-id=${item.id}, data-writer=${item.writer}, data-title=${item.title}"
                           th:text="${item.title}"
                           onclick="checkSecretPost(this)"></a>
                        <span th:if="${item.secretFlag == 1}" class="text-error ml-1">ğŸ”’</span>
                    </td>
                    <td th:text="${item.writer}"></td>
                    <td>
                        <span class="date-box" th:text="${#temporals.format(item.regdate, 'yyyy-MM-dd')}"></span>
                    </td>
                    <td th:text="${item.hit}"></td>
                </tr>
                </tbody>
            </table>

            <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
            <nav class="my-10 flex justify-center">
                <div class="join">
                    <a class="join-item btn"
                       th:href="@{/board/list(page=${responsePageDto.page - 1}, size=${responsePageDto.size}, keyword=${responsePageDto.keyword}, type=${responsePageDto.type})}"
                       th:classappend="${!responsePageDto.hasPrev} ? 'btn-disabled'">ì´ì „</a>

                    <th:block th:each="num : ${#numbers.sequence(responsePageDto.getStartPage(5), responsePageDto.getEndPage(5))}">
                        <a class="join-item btn"
                           th:text="${num}"
                           th:href="@{/board/list(page=${num}, size=${responsePageDto.size}, keyword=${responsePageDto.keyword}, type=${responsePageDto.type})}"
                           th:classappend="${num == responsePageDto.page} ? 'btn-primary'"></a>
                    </th:block>

                    <a class="join-item btn"
                       th:href="@{/board/list(page=${responsePageDto.page + 1}, size=${responsePageDto.size}, keyword=${responsePageDto.keyword}, type=${responsePageDto.type})}"
                       th:classappend="${!responsePageDto.hasNext} ? 'btn-disabled'">ë‹¤ìŒ</a>
                </div>
            </nav>
        </th:block>

        <!-- âœ… ê²Œì‹œê¸€ì´ ì—†ì„ ê²½ìš° -->
        <th:block th:if="${boardList.isEmpty()}">
            <div class="my-10 text-4xl font-bold text-center">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </th:block>
    </div>

    <!-- âœ… ê²€ìƒ‰ ì˜ì—­ -->
    <form th:action="@{/board/list}" method="get"
          class="flex flex-wrap items-center justify-center gap-3 mt-10">
        <select class="select select-bordered w-32" name="type">
            <option th:value="writer"  th:selected="${responsePageDto.type=='writer'}">ê¸€ì“´ì´</option>
            <option th:value="title"   th:selected="${responsePageDto.type=='title'}">ì œëª©</option>
            <option th:value="content" th:selected="${responsePageDto.type=='content'}">ë‚´ìš©</option>
            <option th:value="all"     th:selected="${responsePageDto.type=='all'}">ì „ì²´</option>
        </select>

        <input type="text" name="keyword"
               th:value="${param.keyword}"
               placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
               class="input input-bordered w-64"/>

        <button class="btn btn-primary" type="submit">ê²€ìƒ‰</button>
    </form>

    <!-- âœ… ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ê¸€ì“°ê¸° ë²„íŠ¼ í‘œì‹œ -->
    <div class="mt-10 text-center" th:if="${session.loggedMember != null}">
        <a th:href="@{/board/write}" class="btn btn-primary">ê¸€ì“°ê¸°</a>
    </div>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="pwModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-5 rounded-lg shadow-lg w-80 text-center">
            <p class="font-bold mb-3">ë¹„ë°€ê¸€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” ğŸ”</p>
            <input type="password" id="secretPwInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                   class="input input-bordered w-full mb-3"/>
            <div class="flex justify-center gap-3">
                <button id="confirmBtn" class="btn btn-primary w-24">í™•ì¸</button>
                <button type="button" class="btn w-24" onclick="closePwModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

</main>

<footer th:replace="~{fragments/footer::footer-sns}"></footer>

<script th:inline="javascript">
    const msg = /*[[${msg}]]*/ null;
    if (msg) alert(msg);
</script>

<script>
    function checkSecretPost(link) {
        const modal = document.getElementById("pwModal");
        modal.classList.remove("hidden");
    }
    function closePwModal() {
        const modal = document.getElementById("pwModal");
        modal.classList.add("hidden");
    }
</script>

</body>
</html>
